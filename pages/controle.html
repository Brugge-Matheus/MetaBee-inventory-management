<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/index.css">
    <title>Document</title>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <h3 class="bar-item">Menu</h3>
        <a href="index.html" class="bar-links">Dashboard</a>
        <a href="inventario.html" class="bar-links">Inventário</a>
        <a href="controle.html" class="bar-links">Controle de Acesso</a>
    </div>

    <div style="margin-left:20%">
        
        <section class="main">
    <div class="acesso-container">
        <h2>Controle de Acesso</h2>
        <form id="form-usuario" class="acesso-form">
            <div>
                <label for="nome-usuario"><strong>Nome:</strong></label><br>
                <input type="text" id="nome-usuario" required>
            </div>
            <div>
                <label for="email-usuario"><strong>Email:</strong></label><br>
                <input type="email" id="email-usuario" required>
            </div>
            <div>
                <label for="senha-usuario"><strong>Senha:</strong></label><br>
                <input type="password" id="senha-usuario" required>
            </div>
            <button type="submit">Adicionar Usuário</button>
        </form>
        <div class="acesso-filtro">
            <label for="filtro-nome-usuario"><strong>Filtrar por nome:</strong></label>
            <input type="text" id="filtro-nome-usuario" placeholder="Digite o nome do usuário...">
        </div>
        <table class="acesso-table" id="acesso-table">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Email</th>
                    <th>Senha</th>
                    <th>Data de Criação</th>
                    <th>Data de Atualização</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <div id="modal-editar" class="acesso-modal" style="display:none;">
            <form id="form-editar" class="acesso-form" style="background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.07);padding:24px;border-radius:12px;max-width:400px;margin:auto;">
                <h3>Editar Usuário</h3>
                <input type="hidden" id="editar-idx">
                <div>
                    <label for="editar-nome">Nome:</label><br>
                    <input type="text" id="editar-nome" required>
                </div>
                <div>
                    <label for="editar-email">Email:</label><br>
                    <input type="email" id="editar-email" required>
                </div>
                <div>
                    <label for="editar-senha">Senha:</label><br>
                    <input type="password" id="editar-senha" required>
                </div>
                <button type="submit">Salvar</button>
                <button type="button" id="cancelar-edicao" style="background:#ccc;color:#232526;">Cancelar</button>
            </form>
        </div>
        </table>
    </div>
    <script>
        function getUsuarios() {
            return JSON.parse(localStorage.getItem('usuarios') || '[]');
        }
        function setUsuarios(usuarios) {
            localStorage.setItem('usuarios', JSON.stringify(usuarios));
        }
        function renderTabelaUsuarios() {
            const usuarios = getUsuarios();
            const tbody = document.querySelector('#acesso-table tbody');
            tbody.innerHTML = '';
            usuarios.forEach((usuario, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${usuario.nome}</td><td>${usuario.email}</td><td>${usuario.senha}</td><td>${usuario.dataCriacao}</td><td>${usuario.dataAtualizacao}</td><td><button class='remover-btn' data-idx='${idx}'>Remover</button> <button class='editar-btn' data-idx='${idx}'>Editar</button></td>`;
                tbody.appendChild(tr);
            });
        }
        // Abrir modal de edição
        document.addEventListener('click', function(e) {
            if(e.target.classList.contains('editar-btn')) {
                const idx = e.target.getAttribute('data-idx');
                const usuarios = getUsuarios();
                const usuario = usuarios[idx];
                document.getElementById('editar-idx').value = idx;
                document.getElementById('editar-nome').value = usuario.nome;
                document.getElementById('editar-email').value = usuario.email;
                document.getElementById('editar-senha').value = usuario.senha;
                document.getElementById('modal-editar').style.display = 'block';
            }
        });
        // Cancelar edição
        document.getElementById('cancelar-edicao').addEventListener('click', function() {
            document.getElementById('modal-editar').style.display = 'none';
        });
        // Salvar edição
        document.getElementById('form-editar').addEventListener('submit', function(e) {
            e.preventDefault();
            const idx = document.getElementById('editar-idx').value;
            const nome = document.getElementById('editar-nome').value;
            const email = document.getElementById('editar-email').value;
            const senha = document.getElementById('editar-senha').value;
            const usuarios = getUsuarios();
            usuarios[idx].nome = nome;
            usuarios[idx].email = email;
            usuarios[idx].senha = senha;
            usuarios[idx].dataAtualizacao = new Date().toLocaleString();
            setUsuarios(usuarios);
            renderTabelaUsuarios();
            document.getElementById('modal-editar').style.display = 'none';
        });
        // Filtro de busca por nome
        const filtroUsuarioInput = document.getElementById('filtro-nome-usuario');
        filtroUsuarioInput.addEventListener('input', function() {
            const filtro = filtroUsuarioInput.value.toLowerCase();
            const linhas = document.querySelectorAll('#acesso-table tbody tr');
            linhas.forEach(linha => {
                const nome = linha.children[0].textContent.toLowerCase();
                linha.style.display = nome.includes(filtro) ? '' : 'none';
            });
        });
        // Sistema de criação de usuário
        document.getElementById('form-usuario').addEventListener('submit', function(e) {
            e.preventDefault();
            const nome = document.getElementById('nome-usuario').value;
            const email = document.getElementById('email-usuario').value;
            const senha = document.getElementById('senha-usuario').value;
            const data = new Date();
            const dataCriacao = data.toLocaleString();
            const dataAtualizacao = dataCriacao;
            const usuarios = getUsuarios();
            usuarios.push({nome, email, senha, dataCriacao, dataAtualizacao});
            setUsuarios(usuarios);
            renderTabelaUsuarios();
            this.reset();
        });
        // Remover usuário
        document.addEventListener('click', function(e) {
            if(e.target.classList.contains('remover-btn')) {
                const idx = e.target.getAttribute('data-idx');
                const usuarios = getUsuarios();
                usuarios.splice(idx, 1);
                setUsuarios(usuarios);
                renderTabelaUsuarios();
            }
        });
        // Inicialização
        renderTabelaUsuarios();
    </script>
            
        </section>
    </div>
</body>
</html>